---
deployer:
  image: tuxpiper/ansible-testinfra-docker:ubuntu-trusty-cc
  links:
    - target
  volumes:
    - ./:/etc/ansible/roles/ansible-platform-client-code
    - ./tests:/tests
  encrypted_env_file: deployment.env.encrypted

target:
  image: tuxpiper/ansible-testinfra-docker:ubuntu-trusty

# specific services for pull and build because of the specific image with nodejs
deployer_pull_and_build:
  image: tuxpiper/ansible-testinfra-docker:ubuntu-trusty-cc
  links:
    - target_nodejs:target
  volumes:
    - ./:/etc/ansible/roles/ansible-platform-client-code
    - ./tests:/tests

target_nodejs:
  build:
    image: target_nodejs
    path: tests/docker
    dockerfile_path: target-nodejs.Dockerfile

# specific services for S3 sync
deployer_s3_sync:
  image: tuxpiper/ansible-testinfra-docker:ubuntu-trusty-cc
  links:
    - target_minio:target
  volumes:
    - ./:/etc/ansible/roles/ansible-platform-client-code
    - ./tests:/tests
  environment:
    AWS_ACCESS_KEY_ID: AKIAIOSFODNN7EXAMPLE
    AWS_SECRET_ACCESS_KEY: 'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY'
    AWS_DEFAULT_REGION: us-east-1

target_minio:
  build:
    image: target_minio
    path: tests/docker
    dockerfile_path: target-minio.Dockerfile
  environment:
    MINIO_ACCESS_KEY: AKIAIOSFODNN7EXAMPLE
    MINIO_SECRET_KEY: 'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY'
